<!DOCTYPE HTML>
<html>
    <head>
		<!-- jQuery UI Dependencies -->
		<link href="jquery-ui-1.9.1.custom/css/smoothness/jquery-ui-1.9.1.custom.css" rel="stylesheet">
		<script src="jquery-ui-1.9.1.custom/js/jquery-1.8.2.js"></script>
		<script src="jquery-ui-1.9.1.custom/js/jquery-ui-1.9.1.custom.js"></script>
		<style>
		  body {
			  font-size: 12px;
		  }
		</style>
		
		<!-- Game Dependencies -->
        <script src="Geometry.js" ></script>
        <script src="MovingObject.js" ></script>
        <script src="RenderablePolygon.js" ></script>
        <script src="CityMap.js" ></script>
        <script src="GameUnits.js" ></script>
        <script src="ZombieAI.js" ></script>
        <script src="CivilianAI.js" ></script>
        <script src="SoldierAI.js" ></script>
        <script src="Influencers.js" ></script>
        <script src="SFX.js" ></script>
        <script src="GameEngine.js" ></script>
        <script>
            var GE; //Game engine Global variable
            var GAME_WIDTH = 640;
            var GAME_HEIGHT = 480;
            
            
            
            window.onload = function() {
                loadConfigValuesFromGame();
            
	        // Create a new GameEngine tied to a specific HTML5 Canvas.
                canvas = document.getElementById("gameCanvas");
                context = canvas.getContext("2d");
                
                GE = new GameEngine(canvas);
                GE.init(canvas);
				GE.setDebugCanvas(debugCameraCanvas);
                GE.newGame();
                GE.start();
            };
        </script>
    </head>
    
    <body>
        <table width="100%">
            <tr>
                <td colspan="2" align="center"><h3>JS-Zombies</h3></td>
            </tr>
			
            <tr>
                <td width="650" valign="top">
                    <!-- Game canvas -->
                    <canvas id="gameCanvas" width="640" height="480"></canvas>
                </td>
                
				
				
				
				
				
				
                <td valign="top" rowspan="2">
					<div id="sidebar_tabs">
					  <ul>
						  <li><a href="#sidebar_main-tab">Main</a></li>
						  <li><a href="#sidebar_debug-tab">Debug</a></li>
						  <li><a href="#sidebar_config-tab">Configuration</a></li>
					  </ul>
					  
					  
					  
					  <div id="sidebar_main-tab">
						<!-- Description -->
						<b>Game State:</b><br/>
						<span id="count_zombies" style=""></span>/
						<span id="count_civilians" style="" ></span>/
						<span id="count_total" style="" ></span><br/><br/>
						
						<script>
						  var count_zombies_lbl = document.getElementById("count_zombies");
						  var count_civilians_lbl = document.getElementById("count_civilians");
						  var count_total_lbl = document.getElementById("count_total");
						</script>
                        
                        <b>Game Rules</b><br/>
                        Subject to change as the game develops, but: Use the zombies (purple) to
                        turn all the humans into zombies. If you run out of zombies, you lose.
                        (Only a limited number will spawn at the start of the game).<br/>
                        Soldiers (blue) will shoot back at your zombies, but you can convert them
                        to zombies. Humans are turned into zombies when a zombie touches them.<br/><br/>
						
						
						<b>Controls</b><br/>
						
						<b>Zombie Influence Powers</b><br/>
						(<em>Click then select on the map where to place</em>)<br/>
						<input type="button" id="infl_left_btn" value="Move Left" /><br/>
						<input type="button" id="infl_right_btn" value="Move Right" /><br/>
						<input type="button" id="infl_up_btn" value="Move Up" /><br/>
						<input type="button" id="infl_down_btn" value="Move Down" /><br/>
						<input type="button" id="infl_buff_btn" value="Buff" /><br/>
						<br/>
						<input type="button" id="infl_clear_btn" value="Clear" /><br/>
						
						<script>
						  // Button setup
						  var influence_ids = ["infl_left_btn",
											   "infl_right_btn",
											   "infl_up_btn",
											   "infl_down_btn",
											   "infl_buff_btn"];
						  
						  // TODO: Have this done in a more elegant fashion.
						  //  (On the other hand, this is a temporary job anyway)
						  var west_btn = document.getElementById("infl_left_btn");
						  west_btn.onclick = function(){
							console.log("Mouse Clicked!W");
							var dir = ROAD_DIRECTION_WEST;
							var v = getUnitVectorForDirection(dir);
							var inflr = new MovementInfluencer({x: GAME_WIDTH / 2,
																y: GAME_WIDTH / 2,
																radius: 100,
                                                                duration: 3000,
                                                                opacityFunction: sqrt_decrease,
																direction: dir});
							GE.setCurrentInfluencer(inflr);
						  }
						  
						  
						  var east_btn = document.getElementById("infl_right_btn");
						  east_btn.onclick = function(){
							console.log("Mouse Clicked!E");
							var dir = ROAD_DIRECTION_EAST;
							var inflr = new MovementInfluencer({x: GAME_WIDTH / 2,
																y: GAME_WIDTH / 2,
																radius: 100,
                                                                duration: 3000,
                                                                opacityFunction: sqrt_decrease,
																direction: dir});
							GE.setCurrentInfluencer(inflr);
						  }
						  
						  
						  var nth_btn = document.getElementById("infl_up_btn");
						  nth_btn.onclick = function(){
							console.log("Mouse Clicked!N");
							var dir = ROAD_DIRECTION_NORTH;
							var inflr = new MovementInfluencer({x: GAME_WIDTH / 2,
																y: GAME_WIDTH / 2,
																radius: 100,
                                                                duration: 3000,
                                                                opacityFunction: sqrt_decrease,
																direction: dir});
							GE.setCurrentInfluencer(inflr);
						  }
						  
						  
						  var sth_btn = document.getElementById("infl_down_btn");
						  sth_btn.onclick = function(){
							console.log("Mouse Clicked!");
							var dir = ROAD_DIRECTION_SOUTH;
							var inflr = new MovementInfluencer({x: GAME_WIDTH / 2,
																y: GAME_WIDTH / 2,
																radius: 100,
                                                                duration: 3000,
                                                                opacityFunction: sqrt_decrease,
																direction: dir});	
							GE.setCurrentInfluencer(inflr);					
						  }
						  
						   var buff_btn = document.getElementById("infl_buff_btn");
						   buff_btn.onclick = function(){
							console.log("Mouse Clicked!");				    
							var inflr = new BuffInfluencer({x: GAME_WIDTH / 2,
																y: GAME_WIDTH / 2,
																radius: 100,
                                                                duration: 3000,
                                                                opacityFunction: sqrt_decrease,
																direction: null});	
							GE.setCurrentInfluencer(inflr);					
						  }
						  var clear_btn = document.getElementById("infl_clear_btn");
						  clear_btn.onclick = function(){
							console.log("Mouse Clicked!none");
							GE.setCurrentInfluencer(null);
						  }
						</script>
					  </div>
					  
					  
					  
					  <div id="sidebar_debug-tab">
						<b>Debug Tab</b><br/><br/>
						
                        <input type="checkbox" id="debug_enable_checkbox" checked="false" /> Enable Debugging<br/><br/>
                        <script>
                            var chkbxEnableDebug = document.getElementById("debug_enable_checkbox");
                            chkbxEnableDebug.onclick = function(evt){
                                GE.__debugEnabled = chkbxEnableDebug.checked;
                            };
                        </script>
                        
						<b>Game Speed:</b><br/>
						<input id="gameSpeedSlider" type="range" value="1" min="0.1" max="2" step="0.1" />
						<span id="gameSpeedLabel"></span><br/>
						<br/>
						<script>
						  var gameSpeedSlider = document.getElementById("gameSpeedSlider");
						  var gameSpeedLabel = document.getElementById("gameSpeedLabel");
						</script>
						
						<b>Camera:</b><br/>
						<table width="100%">
						  <tr>
							<td width="320">
							  <!-- Debug Canvas for Camera -->
							  <canvas id="debugCameraCanvas" width="320" height="240"></canvas>
							  <script>
								var debugCameraCanvas = document.getElementById("debugCameraCanvas");
							  </script>
							</td>
							<td valign="top">
							  <!-- Debug Canvas Zoom Controls -->
							  <b>Zoom</b><br/>
							  <input id="debugCameraCanvasZoomSlider" type="range" value="0.5" min="0.5" max="5" step="0.05" />
							  <span id="debugCameraCanvasZoomLabel"></span><br/>
							  <br/>
							  <script>
								var debugCameraCanvasZoomSlider = document.getElementById("debugCameraCanvasZoomSlider");
								var debugCameraCanvasZoomLabel = document.getElementById("debugCameraCanvasZoomLabel");
							  </script>
							  
							  <b>Focus on Unit:</b><br>
							  
							  <span id="debugCameraUnitFocusCycle">
								<input type="button" id="debugCameraUnitFocusPrev_btn" value="<" />
								<input type="button" id="debugCameraUnitFocusNext_btn" value=">" />
							  </span>
							  
							  <span id="debugCameraUnitFocus_div" class="ui-widget">
								<!-- Get selected using $("#debugCameraUnitFocus_combo option:selected").val() -->
								<select id="debugCameraUnitFocus_combo">
								  <option value="">None</option>
								</select>
							  </span>
							</td>
						  </tr>
						</table>
						
						
						<style>
						.ui-combobox {
							position: relative;
							display: inline-block;
						}
						.ui-combobox-toggle {
							position: absolute;
							top: 0;
							bottom: 0;
							margin-left: -1px;
							padding: 0;
							/* adjust styles for IE 6/7 */
							*height: 1.7em;
							*top: 0.1em;
						}
						.ui-combobox-input {
							margin: 0;
							padding: 0.3em;
						}
						</style>
					  </div>
					  
					  
					  
					  <div id="sidebar_config-tab">
                        <b>Game Configuration</b><br/>
                        
                        
                        <input type="button" value="Load Values" onclick="loadConfigValuesFromGame()" />
                        <input type="button" value="Save Values" onclick="saveConfigValuesToGame()" /><br/><br/>
                        <script>
                            function bindValueTo(id, variableName){
                                /*
                                  Here we bind the value of each text input
                                   by setting an attribute of the DOM element
                                */
                                
                                var el = document.getElementById(id);
                                el.setAttribute("bindvariable", variableName);
                            }
                            
                            
                            
                            function loadConfigValuesFromGame(){
                                // Check through all input elements
                                // and load the values into the ones
                                // with the 'bindvariable' attribute.
                                
                                var inputs = document.getElementsByTagName("input");
                                for(var i = 0; i < inputs.length; i++){
                                    var el = inputs[i];
                                    
                                    var varName = el.getAttribute("bindvariable");
                                    if(varName){
                                        el.value = this[varName];
                                    }
                                }
                            }
                            
                            
                            
                            function saveConfigValuesToGame(){
                                // Check through all input elements
                                // and save the values from the ones
                                // with the 'bindvariable' attribute.
                                
                                var inputs = document.getElementsByTagName("input");
                                for(var i = 0; i < inputs.length; i++){
                                    var el = inputs[i];
                                    
                                    var varName = el.getAttribute("bindvariable");
                                    if(varName){
                                        // NOTE: The values ought to be NUMBERS.
                                        this[varName] = +el.value;
                                    }
                                }
                                
                            }
                        </script>
                        
                        
                        <!-- Map Generation Configuration -->
                        <b>Map Generation:</b><br/>
                        <input type="radio" name="map_generation_rdo" id="cfg_mapgen0_rdo" value="0" />
                        Grid Map<br/>
                        
                        <input type="radio" name="map_generation_rdo" id="cfg_mapgen1_rdo" value="1" checked="true" />
                        Random Generation<br/>
                        <br/>
                        
                        <script>
                            // This is a bit hackish, but is sufficient for our needs.
                            document.getElementById("cfg_mapgen0_rdo").onclick = function(){ MAP_SELECTED_GENERATOR = 0; };
                            document.getElementById("cfg_mapgen1_rdo").onclick = function(){ MAP_SELECTED_GENERATOR = 1; };
                        </script>
                        
                        
                        <!-- Unit Population Configuration -->
                        <b>Map Populations</b><br/>
                        <input type="text" id="cfg_initciv_txt" size="2" />
                        Initial # Civilians<br/>
                        
                        <input type="text" id="cfg_initsol_txt" size="2" />
                        Initial # Soldiers<br/>
                        
                        <input type="text" id="cfg_spwnzom_txt" size="2" />
                        Spawn # Zombies<br/>
                        <br/>
                        
                        <script>
                            bindValueTo("cfg_initciv_txt", "MAX_CIVILIAN_COUNT");
                            bindValueTo("cfg_initsol_txt", "MAX_SOLDIER_COUNT");
                            bindValueTo("cfg_spwnzom_txt", "GAME_DEFAULT_NUMBER_ZOMBIES");
                        </script>
                        
                        
                        <!-- Soldier Strength Configuration -->
                        <b>Soldier Damage</b><br/>
                        <input type="text" id="cfg_solfiredelay_txt" size="4" />
                        Soldier Fire Period<br/>
                        
                        <input type="text" id="cfg_soldmg_txt" size="4" />
                        Soldier Bullet Damage<br/>
                        
                        <script>
                            bindValueTo("cfg_solfiredelay_txt", "SOLDIER_DEFAULT_SHOOT_PERIOD");
                            bindValueTo("cfg_soldmg_txt", "SOLDIER_DEFAULT_BULLET_DAMAGE");
                        </script>
                        
                      </div>
					</div>
					
					
					
                    <script src="jqueryConfig.js">
					</script>
                </td>
            </tr>
            <tr>
                <td>
                    <!-- Control buttons -->
                    <input type="button" value="New Game" onclick="GE.newGame();GE.start()" />
                    <input type="button" value="Pause Game" onclick="GE.pause()" />
                    <input type="button" value="Resume Game" onclick="GE.start()" />
                </td>
            </tr>
        </table>
    </body>
</html>
